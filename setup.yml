---
- name: a playbook to setup my local machine with my basic customizations
  hosts: local
  connection: local
  gather_facts: false

  pre_tasks:
    - name: Update and upgrade apt packages
      become: true
      apt:
        upgrade: true
        update_cache: true
        force_apt_get: true
      tags:
        - apt
    - name: Run apt-get autoremove
      become: true
      apt:
        autoremove: true
        force_apt_get: true
      tags:
        - apt
    - name: Run apt-get autoremove
      become: true
      shell: /usr/sbin/update-ca-certificates
      tags:
        - apt

  tasks:
    - name: install dependencies
      apt:
        name: "{{ item }}"
        state: latest
        force_apt_get: true
        install_recommends: false
      with_items:
        - vim
        - htop
        - curl
        - wget
        - automake
        - make
        - m4
        - libtool
        - pkg-config
        - libevent-dev
        - libncurses-dev
        - tree
        - git
        - sshpass
        - snapcraft
        - rpm
        - jq
        - build-essential
        - keychain
        - unzip
        - ack-grep
        - direnv
        - p7zip-full
        - p7zip-rar
        - python3-venv
        - mingw-w64
        - openjdk-8-jdk-headless
        - pass
        - gnupg2
        - traceroute
        - zlib1g-dev
        - libssl-dev
        - libreadline-dev
        - libbz2-dev
        - libsqlite3-dev
        - ipcalc
        - dos2unix
      become: true
      tags:
        - apt
        - java
    - name: Install Pyenv
      git:
        repo: 'https://github.com/pyenv/pyenv.git'
        dest: "{{ lookup('env','HOME') }}/.pyenv"
        version: v1.2.11
      tags:
        - apt
        - python
    - name: Create ADR Tools dir
      file:
        path: "/tmp/adr-tools"
        state: directory
      tags:
        - apt
        - adr
    - name: Get ADR Tools
      unarchive:
        src: https://github.com/npryce/adr-tools/archive/3.0.0.zip
        dest: "/tmp/adr-tools"
        remote_src: yes
      tags:
        - apt
        - adr
    - name: Install ADR Tools
      command: cp -R /tmp/adr-tools/adr-tools-3.0.0 "{{ lookup('env','HOME') }}/bin/adr-tools"
      tags:
        - apt
        - adr
    - name: Clean ADR Tools dir
      file:
        path: "/tmp/adr-tools"
        state: absent
      tags:
        - apt
        - adr
    - name: Install httpie
      pip:
        name: httpie
        state: latest
      tags:
        - pip
    - name: Install awscli
      pip:
        name: awscli
        state: latest
        extra_args: --user
      tags:
        - pip
    - name: Install virtualenv
      pip:
        name: virtualenv
        state: latest
      tags:
        - pip
    - name: Install CloudFormation Linter
      pip:
        name: cfn-lint
        state: latest
        extra_args: --user
      tags:
        - pip
    - name: Install AWS SAM CLI
      pip:
        name: aws-sam-cli
        state: latest
        extra_args: --user
      tags:
        - pip

  roles:
    - {role: dot, tags: [dot, bash]}
    - {role: ssh, tags: [ssh]}
    - {role: andrewrothstein.sudoers, tags: [sudo]}
    - {role: golang, tags: [golang]}
    - {role: java, tags: [java]}
    - {role: k8s, tags: [k8s]}
    - {role: wsl, tags: [wsl]}

  post_tasks:
    - shell: echo 'I":" Beginning to configure web server..'
